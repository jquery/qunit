<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>QUnit Autostart Test Suite</title>
	<link rel="stylesheet" href="../dist/qunit.css">
</head>
<body>
	<div id="qunit"></div>
	<script src="../dist/qunit.js"></script>
	<script>
	var beginData,
		asyncDelay = 1000,
		times = {
			autostartOff: 0,
			pageLoaded: 0,
			runStarted: 0
		};

	(function() {
		/**
		 * @param {HTMLElement} elem
		 * @param {string} type
		 * @param {Function} fn
		 */
		function addEvent( elem, type, fn ) {
			if ( elem.addEventListener ) {

				// Standards-based browsers
				elem.addEventListener( type, fn, false );
			} else if ( elem.attachEvent ) {

				// support: IE <9
				elem.attachEvent( "on" + type, function() {
					var event = window.event;
					if ( !event.target ) {
						event.target = event.srcElement || document;
					}

					fn.call( elem, event );
				});
			}
		}

		/**
		 * @param {HTMLElement} elem
		 * @param {string} type
		 * @param {Function} fn
		 */
		function removeEvent( elem, type, fn ) {
			if ( elem.removeEventListener ) {

				// Standards-based browsers
				elem.removeEventListener( type, fn, false );
			} else if ( elem.detachEvent ) {

				// support: IE <9
				elem.detachEvent( "on" + type, function() {
					var event = window.event;
					if ( !event.target ) {
						event.target = event.srcElement || document;
					}

					fn.call( elem, event );
				});
			}
		}

		var now = Date.now || function() {
			return new Date().getTime();
		};

		QUnit.config.autostart = false;

		// Mark the current time
		times.autostartOff = now();

		// Simulate a delay in loading the tests, as when they are loaded
		// asynchronously using requirejs, steal, etc.
		setTimeout(function() {
			var script = document.createElement( "script" );
			script.src = "autostart.js";
			document.getElementsByTagName( "head" )[0].appendChild( script );
		}, asyncDelay );

		// Unregister old load function load
		removeEvent( window, "load", QUnit.load );

		// register new load function
		addEvent( window, "load", function(){
			times.pageLoaded = now();
			QUnit.load();
		} );



		QUnit.begin(function( data ) {
			beginData = data;
			times.runStarted = now();
		});
	})();
	</script>
	<script src="swarminject.js"></script>
</body>
</html>
